<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 680">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/>
    </marker>
    <marker id="arrowhead-blue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6"/>
    </marker>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.15"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="900" height="680" fill="#f8fafc"/>

  <!-- Title -->
  <text x="450" y="35" text-anchor="middle" font-family="system-ui, -apple-system, sans-serif" font-size="22" font-weight="bold" fill="#1e293b">LinkedIn Job Alert Agent - Optimized Workflow</text>

  <!-- Step 1: Gmail -->
  <g filter="url(#shadow)">
    <rect x="50" y="70" width="160" height="70" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
    <text x="130" y="98" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="600" fill="#92400e">1. FETCH EMAILS</text>
    <text x="130" y="118" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" fill="#78350f">Gmail API</text>
    <text x="130" y="132" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#a16207">Unread job alerts</text>
  </g>

  <!-- Arrow 1->2 -->
  <line x1="210" y1="105" x2="250" y2="105" stroke="#64748b" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Step 2: Parse -->
  <g filter="url(#shadow)">
    <rect x="260" y="70" width="160" height="70" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
    <text x="340" y="98" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="600" fill="#1e40af">2. PARSE JOBS</text>
    <text x="340" y="118" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" fill="#1e3a8a">HTML Parser</text>
    <text x="340" y="132" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#3730a3">Extract job details</text>
  </g>

  <!-- Arrow 2->3 -->
  <line x1="420" y1="105" x2="460" y2="105" stroke="#64748b" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Step 3: Dedupe Batch -->
  <g filter="url(#shadow)">
    <rect x="470" y="70" width="160" height="70" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
    <text x="550" y="98" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="600" fill="#1e40af">3. DEDUPLICATE</text>
    <text x="550" y="118" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" fill="#1e3a8a">Within Batch</text>
    <text x="550" y="132" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#3730a3">Remove duplicates</text>
  </g>

  <!-- Arrow 3->4 -->
  <line x1="630" y1="105" x2="670" y2="105" stroke="#64748b" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Step 4: Load Sheet -->
  <g filter="url(#shadow)">
    <rect x="680" y="70" width="160" height="70" rx="8" fill="#dcfce7" stroke="#22c55e" stroke-width="2"/>
    <text x="760" y="98" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="600" fill="#166534">4. LOAD SHEET</text>
    <text x="760" y="118" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" fill="#14532d">Sheets API</text>
    <text x="760" y="132" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#15803d">Get existing job IDs</text>
  </g>

  <!-- Arrow 4->5 (down) -->
  <line x1="760" y1="140" x2="760" y2="180" stroke="#64748b" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Step 5: Filter -->
  <g filter="url(#shadow)">
    <rect x="680" y="190" width="160" height="90" rx="8" fill="#fae8ff" stroke="#d946ef" stroke-width="2"/>
    <text x="760" y="218" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="600" fill="#86198f">5. FILTER JOBS</text>
    <text x="760" y="238" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#701a75">New jobs (not in sheet)</text>
    <text x="760" y="253" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#701a75">+ Existing without</text>
    <text x="760" y="268" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#701a75">probability score</text>
  </g>

  <!-- Arrow 5->6 (left) -->
  <line x1="680" y1="235" x2="640" y2="235" stroke="#64748b" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Step 6: Load Resume (conditional) -->
  <g filter="url(#shadow)">
    <rect x="470" y="190" width="160" height="90" rx="8" fill="#e0e7ff" stroke="#6366f1" stroke-width="2"/>
    <text x="550" y="218" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="600" fill="#3730a3">6. LOAD RESUME</text>
    <text x="550" y="238" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" fill="#312e81">Google Docs API</text>
    <text x="550" y="258" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#4338ca">Fetched ONCE</text>
    <text x="550" y="273" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#4338ca">Cached for session</text>
  </g>

  <!-- Arrow 6->7 (left) -->
  <line x1="470" y1="235" x2="430" y2="235" stroke="#64748b" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Step 7: Gemini Analysis -->
  <g filter="url(#shadow)">
    <rect x="180" y="190" width="240" height="90" rx="8" fill="#fef2f2" stroke="#ef4444" stroke-width="2"/>
    <text x="300" y="218" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="600" fill="#991b1b">7. AI ANALYSIS (Gemini 2.5 Flash)</text>
    <text x="300" y="238" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#7f1d1d">Google Search grounding fetches job descriptions</text>
    <text x="300" y="253" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#7f1d1d">Match probability 0-100%</text>
    <text x="300" y="268" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#b91c1c">Only analyzes FILTERED jobs (~30-40s each)</text>
  </g>

  <!-- Arrow 7->8 (down) -->
  <line x1="300" y1="280" x2="300" y2="320" stroke="#64748b" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Step 8: Write Sheet -->
  <g filter="url(#shadow)">
    <rect x="180" y="330" width="240" height="90" rx="8" fill="#dcfce7" stroke="#22c55e" stroke-width="2"/>
    <text x="300" y="358" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="600" fill="#166534">8. WRITE TO SHEET</text>
    <text x="300" y="378" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#14532d">Add new jobs with probability &amp; status</text>
    <text x="300" y="393" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#14532d">Update existing jobs if data changed</text>
    <text x="300" y="408" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#15803d">Skip unchanged duplicates</text>
  </g>

  <!-- Arrow 8->9 (down) -->
  <line x1="300" y1="420" x2="300" y2="460" stroke="#64748b" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Step 9: Mark Processed -->
  <g filter="url(#shadow)">
    <rect x="180" y="470" width="240" height="70" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
    <text x="300" y="498" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="600" fill="#92400e">9. MARK PROCESSED</text>
    <text x="300" y="518" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" fill="#78350f">Gmail: Label + Read + Archive</text>
  </g>

  <!-- Optimization callout box -->
  <g filter="url(#shadow)">
    <rect x="530" y="350" width="320" height="120" rx="8" fill="#f0fdf4" stroke="#16a34a" stroke-width="2" stroke-dasharray="5,3"/>
    <text x="690" y="375" text-anchor="middle" font-family="system-ui, sans-serif" font-size="13" font-weight="bold" fill="#166534">OPTIMIZATION</text>
    <text x="690" y="400" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" fill="#15803d">Jobs already in sheet with probability</text>
    <text x="690" y="418" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" fill="#15803d">are SKIPPED from Gemini analysis</text>
    <line x1="560" y1="432" x2="820" y2="432" stroke="#22c55e" stroke-width="1"/>
    <text x="690" y="452" text-anchor="middle" font-family="system-ui, sans-serif" font-size="11" font-weight="600" fill="#166534">20 jobs, 15 existing = analyze only 5</text>
    <text x="690" y="467" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#16a34a">~10 min reduced to ~2.5 min</text>
  </g>

  <!-- Legend -->
  <g>
    <rect x="50" y="560" width="800" height="100" rx="8" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="1"/>
    <text x="450" y="585" text-anchor="middle" font-family="system-ui, sans-serif" font-size="12" font-weight="bold" fill="#475569">LEGEND</text>

    <!-- Gmail -->
    <rect x="80" y="600" width="20" height="20" rx="3" fill="#fef3c7" stroke="#f59e0b" stroke-width="1"/>
    <text x="110" y="615" font-family="system-ui, sans-serif" font-size="11" fill="#475569">Gmail API</text>

    <!-- Processing -->
    <rect x="200" y="600" width="20" height="20" rx="3" fill="#dbeafe" stroke="#3b82f6" stroke-width="1"/>
    <text x="230" y="615" font-family="system-ui, sans-serif" font-size="11" fill="#475569">Processing</text>

    <!-- Sheets -->
    <rect x="320" y="600" width="20" height="20" rx="3" fill="#dcfce7" stroke="#22c55e" stroke-width="1"/>
    <text x="350" y="615" font-family="system-ui, sans-serif" font-size="11" fill="#475569">Sheets API</text>

    <!-- Filter -->
    <rect x="440" y="600" width="20" height="20" rx="3" fill="#fae8ff" stroke="#d946ef" stroke-width="1"/>
    <text x="470" y="615" font-family="system-ui, sans-serif" font-size="11" fill="#475569">Filter Logic</text>

    <!-- Docs -->
    <rect x="560" y="600" width="20" height="20" rx="3" fill="#e0e7ff" stroke="#6366f1" stroke-width="1"/>
    <text x="590" y="615" font-family="system-ui, sans-serif" font-size="11" fill="#475569">Docs API</text>

    <!-- Gemini -->
    <rect x="680" y="600" width="20" height="20" rx="3" fill="#fef2f2" stroke="#ef4444" stroke-width="1"/>
    <text x="710" y="615" font-family="system-ui, sans-serif" font-size="11" fill="#475569">Gemini AI (slow)</text>
  </g>

  <!-- Footer -->
  <text x="450" y="670" text-anchor="middle" font-family="system-ui, sans-serif" font-size="10" fill="#94a3b8">Cloud Function runs on schedule via Cloud Scheduler (every 4-6 hours)</text>
</svg>
